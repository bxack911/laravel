version: "3"
 
services:
    apache:
        build: ./docker/apache
        ports:
            - "8081:80"
        environment:
            DOCKER_HOST: "unix:///var/run/docker.sock"
        volumes:
            - ./html:/var/www/html/:z
            - ./docker/apache/php.ini:/usr/local/etc/php/php.ini:z
        networks:
            - backend
 
    db:
        image: "mysql:8"
        volumes:
            - ./docker/db:/var/lib/mysql
        environment:
               MYSQL_ROOT_PASSWORD: pass
               MYSQL_DATABASE: sprava_lara
               MYSQL_USER: sprava_lara
               MYSQL_PASSWORD: pass
        networks:
            - backend
 
    phpmyadmin:
        image: phpmyadmin/phpmyadmin:latest
        environment:
            - PMA_HOST=db
            - PMA_USER=sprava_lara
            - PMA_PASSWORD=pass
        volumes:
            - ./docker/apache/upload.ini:/usr/local/etc/php/php.ini:z
            - /sessions
        ports:
            - "8082:80"
        networks:
            - backend

    rabbitmq:
        image: rabbitmq:3-management
        hostname: my-rabbit
        volumes:
            - ./rabbitmq/definitions.json:/etc/rabbitmq/definitions.json
            - ./rabbitmq/rabbitmq.conf:/etc/rabbitmq/rabbitmq.conf
            #- ./rabbitmq/data:/var/lib/rabbitmq/mnesia/rabbit@my-rabbit
            #- ./rabbitmq/logs:/var/log/rabbitmq/log
        ports:
            - 5672:5672
            - 15672:15672
networks:
    front:
        external:
            name: front
    backend: